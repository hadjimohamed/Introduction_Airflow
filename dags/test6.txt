from datetime import datetime,timedelta
from airflow import DAG 
from airflow.operators.python import PythonOperator 
import pandas as pd
def import_data():
    df=pd.read_csv("/opt/airflow/data/insurance.csv")
    json_data=df.to_json()
    print(json_data)
    return json_data
def drop_null(**kwargs):
    ti=kwargs['ti']
    data_json=ti.xcom_pull(task_ids='task1')
    df=pd.read_json(data_json)
    df.dropna(inplace=True)
    print(df)
    return df.to_json()
def moyenne_age(**kwargs):
    ti=kwargs['ti']
    json_data=ti.xcom_pull(task_ids='task2')
    df=pd.read_json(json_data)
    moyenne_age=df['age'].mean()
    return moyenne_age
default_args={
    'owner':'mohamed'
}
with DAG(
    dag_id='pipeline_data',
    start_date=datetime(2025,1,16),
    schedule_interval="@once"
) as dag:
    task1=PythonOperator(
        task_id='task1',
        python_callable=import_data
    )
    task2=PythonOperator(
        task_id='task2',
        python_callable=drop_null,
        do_xcom_push=True
    )
    task3=PythonOperator(
    task_id='task3',
    python_callable=moyenne_age,
    do_xcom_push=True
)

task1>>task2>>task3